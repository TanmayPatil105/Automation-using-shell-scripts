#!/bin/bash
cols=$(tput cols)
GREEN="\e[32m"
ENDCOLOR="\e[0m"
if [ $# == 0 ]
then
	echo "Try wifi --help or -h for more information"
	exit 1
fi
if [ $1 == "--help" -o $1 == "-h" ]
then
	cat /usr/share/wifi/help.txt
	exit 1
fi
if [ $1 == "list" ]
then 
	if [ $(nmcli radio wifi) == "enabled" ]
	then
		if [ `expr $cols` -lt  110 ]
		then
			resize -s 24 110 > /dev/null
		fi
		nmcli dev wifi list > /tmp/wifi.txt
		cat /tmp/wifi.txt
		rm /tmp/wifi.txt
	else 
		echo "Wifi is disabled"

	fi
fi
if [ $1 == "connect" ]
then
	nmcli dev wifi connect $2
fi
if [ $1 == "on" ]
then
	if [ $(nmcli radio wifi) == "enabled" ]
	then
		echo "Wifi is already enabled"
	else 
		nmcli radio wifi on
		echo "Turned on WIFI"
	fi
fi
if [ $1 == "off" ]
then 
	if [ $(nmcli radio wifi) == "disabled" ]
	then 
		echo "Wifi is already disabled"
	else 
		nmcli radio wifi off
		echo "Turned off WIFI"
	fi
fi
if [ $1 == "pass" ]
then 
	if [ $(nmcli radio wifi) == "disabled" ]
        then
		echo "Wifi is already disabled"
        else
                nmcli dev wifi show-password

        fi
fi
if [ $1 == "saved" ]
then
	arr=()
	while IFS= read -r line; do
   		 arr+=( "$line" )
	done < <(cd /etc/NetworkManager/system-connections ;ls)
	i=0
	sol=()
	while IFS= read -r line; do
                 sol+=( "$line" )
        done < <(while [ $i -lt  ${#arr[@]} ]
        do
                echo  "${arr[$i]}" | cut -d'.' -f 1
                 i=`expr $i + 1`
        done)
	#echo -e "$GREEN" 
	printf '\e[32m%s\t' "${sol[@]}"
	echo -e "$ENDCOLOR"

fi

if [ $1 == "hotspot" ]
then
	if [ $(nmcli radio wifi) == "disabled" ]
        then
                echo "Wifi is turned off!"
		echo "Turn on wifi"
		echo "Try \"wifi --help or -h\" for help"
		exit 1
	fi
	timeout 5s echo "Setting up Hotspot"
	nmcli con up Hotspot 
	timeout 1s echo "Showing Password" > /dev/null
	nmcli dev wifi show-password
fi
